<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8"/>
  <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>모집(mo.zip) - 멤버 모집</title>
  <!-- css / font -->
  <!-- 아이콘 : font-awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"/>

  <!-- 직접 구현한 CSS -->
  <link rel="stylesheet" th:href="@{/css/reset.css}"/>
  <link rel="stylesheet" th:href="@{/css/common.css}"/>
  <link rel="stylesheet" th:href="@{/css/index.css}"/>
  <link rel="stylesheet" th:href="@{/css/list.css}"/>
  <!-- js -->
  <!-- jquery -->
  <script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
          crossorigin="anonymous"></script>
  <!-- swiper -->
  <script th:src="@{/js/index.js}"></script>
  <script th:src="@{/js/common.js}"></script>
  <!-- favicon -->
  <link rel="icon" th:href="@{/img/favicon.ico}">
</head>

<body>
<header id="header">
  <th:block th:replace="~{fragment/header}"></th:block>
</header>
<div class="wrap recruit-list">
  <div class="category">
    <h1>📃 카테고리</h1>
    <ul>
      <li id="all" class="on"><a href="#">전체</a></li>
      <li id="frontend"><a href="#" onclick="projectFilterFront()">프론트엔드</a></li>
      <li id="backend"><a href="#" onclick="projectFilterBack()">백엔드</a></li>
      <li id="design"><a href="#" onclick="projectFilterDesign()">디자인</a></li>
      <li id="manager"><a href="#" onclick="projectFilterManager()">기획</a></li>
      <li id="etc"><a href="#" onclick="projectFilterEtc()">기타</a></li>
    </ul>
    <button class="btn-write" onclick="createValidation()">모집글 작성하기</button>
    <div class="hidden-session" th:text="${session.loginMember}" style="display: none"></div>
  </div>
  <div class="project-list">
    <div class="search">
      <input type="text" placeholder="제목, 내용으로 검색" class="recruit-ipt" onkeydown="handleKeyDown(event)"/>
      <button class="search-remove" onclick="clearSearch()"><i class="fa-solid fa-xmark"></i></button>
      <button class="search-on" onclick="searchProjects()"><i class="fa-solid fa-magnifying-glass"></i></button>
    </div>
    <div class="list-top">
      <div class="tapmenu">
        <ul>
          <li id="typeAll" class="on"><a href="#" onclick="projectTypeAllFilter()">전체</a></li>
          <li id="typeSide"><a href="#" onclick="projectTypeSideFilter()">사이드 프로젝트</a></li>
          <li id="typeStudy"><a href="#" onclick="projectTypeSudyFilter()">스터디/모임</a></li>
        </ul>
      </div>
      <select class="select" onchange="handleSelectFilter(event)">
        <option value="all">전체 모집 글</option>
        <option value="1" >모집 중</option>
        <option value="0" >모집 완료</option>
      </select>
    </div>

    <div class="lists">
      <a th:href="@{/project/{project}(project=${project.getId()})}" th:each="project : ${allProject}" class="project-box">
        <span class="pj-type" th:classappend="${project.getProjectType() == '사이드 프로젝트'? 'pj' : 'study'}" th:text="${project.getProjectType()}"></span>
        <p class="title">
          <strong class="state-ing" th:text="${project.getStatus() == 1 ? '모집 중' : '모집완료' }">모집 중</strong>
          <span th:text="${project.getProjectName()}">엘리스 SW 4기 모집합니다!</span>
        </p>
        <div class="cont-wrap">
          <p class="content" th:text="${project.getProjectInfo()}">
            열심히 코딩해서 멋진 개발자가 인재들을 모집합니다.열심히
            코딩해서 멋진 개발자가 인재 들을 모집합니다.열심히 코딩해서 멋진
            개발자가 인재들을 모집합니다.열심히 코딩해서 멋진 개발자가
            인재들을 모집합니다.열심히 코딩해서 멋진 개발자가 인재들을
            모집합니다.열심히 코딩해서 멋진 개발자가 인재들을
            모집합니다.열심히 코딩해서 멋진 개발자가 인재들을 모집합니다.
          </p>
        </div>
        <ul class="pj-work">
          <li th:each="role : ${project.getRoleNames()}">
            <th:block th:text="${role}"></th:block>
          </li>
        </ul>
        <ul class="count">
          <li th:text="${project.getCreateTime()}">2024.05.30</li>
          <li><i class="fa-regular fa-hand"></i>
            <th:block th:text="${project.getSubscribe()} + '명'">8개</th:block>
          </li>
          <li><i class="fa-solid fa-eye"></i>
            <th:block th:text="${project.getViews()} + '회'">16회</th:block>
          </li>
        </ul>
      </a>
    </div>
  </div>
</div>
<footer>
  <th:block th:replace="~{fragment/footer}"></th:block>
</footer>
</body>
<script>
    function createValidation() {
        let member = document.querySelector(".hidden-session").textContent;
        if (member == null) {
            alert("로그인을 먼저 진행해주세요 !");
            window.location.assign("/auth/login");
        } else {
            window.location.assign("/project/create");
        }
    }

    // 프로젝트 타입(사이드, 스터디모임) 필터
    function projectTypeAllFilter(){
        window.location.reload();
    }

    function projectTypeSideFilter(){
        let filter="사이드 프로젝트";
        $.ajax({
            url: `api/project/type/${filter}`,
            type: "get",
            dataType: "json"
        }).done(res=>{
            console.log("성공", res);
            $('.lists').empty();
            $('#typeAll').removeClass();
            $('#typeStudy').removeClass();
            $('#typeSide').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error=>{
            console.log("실패", error);
        });
    }
    function projectTypeSudyFilter(){
        let filter = "스터디모집"
        $.ajax({
            url: `api/project/type/${filter}`,
            type: "get",
            dataType: "json"
        }).done(res=>{
            console.log("성공", res);
            $('.lists').empty();
            $('#typeAll').removeClass();
            $('#typeSide').removeClass();
            $('#typeStudy').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error=>{
            console.log("실패", error);
        });
    }





    // 셀렉트 필터(전체모집글, 모집중, 모집완료)
    function handleSelectFilter(event) {
        // 전체모집글 : all, 모집중 : 0 , 모집완료 : 1
        let selectedValue = event.target.value;

        if (selectedValue == 'all')
            window.location.reload();
        else {
            $.ajax({
                url: `api/project/select/${selectedValue}`,
                type: "get",
                dataType: "json"
            }).done(res => {
                console.log("성공", res);
                $('.lists').empty();
                if (res.data.length === 0) {
                    $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
                } else {
                    // 새로운 프로젝트 리스트를 추가합니다.
                    res.data.forEach(project => {
                        $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                    });
                }
            }).fail(error => {
                console.log("실패", error);
            });
        }
    }

    // 카테고리 전체 클릭 시
    document.querySelector('#all').addEventListener("click", function () {
        window.location.reload();
    });

    // 프론트 필터
    function projectFilterFront() {
        $.ajax({
            type: "POST",
            url: "/api/project/filter",
            contentType: "application/x-www-form-urlencoded; charset=utr-8",
            data: {"filter": "프론트엔드"}
        }).done(res => {
            console.log("성공", res);
            $('.lists').empty();

            $('#all').removeClass();
            $('#backend').removeClass();
            $('#design').removeClass();
            $('#manager').removeClass();
            $('#etc').removeClass();

            $('#frontend').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error => {
            console.log("실패", error);
        })
    }


    // 백 필터
    function projectFilterBack() {
        $.ajax({
            type: "POST",
            url: "/api/project/filter",
            contentType: "application/x-www-form-urlencoded; charset=utr-8",
            data: {"filter": "백엔드"}
        }).done(res => {
            console.log("성공", res);
            $('.lists').empty();

            $('#all').removeClass();
            $('#frontend').removeClass();
            $('#design').removeClass();
            $('#manager').removeClass();
            $('#etc').removeClass();

            $('#backend').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error => {
            console.log("실패", error);
        })
    }

    // 디자이너 필터
    function projectFilterDesign() {
        $.ajax({
            type: "POST",
            url: "/api/project/filter",
            contentType: "application/x-www-form-urlencoded; charset=utr-8",
            data: {"filter": "디자이너"}
        }).done(res => {
            console.log("성공", res);
            $('.lists').empty();

            $('#all').removeClass();
            $('#backend').removeClass();
            $('#frontend').removeClass();
            $('#manager').removeClass();
            $('#etc').removeClass();

            $('#design').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error => {
            console.log("실패", error);
        })
    }

    // 기획 필터
    function projectFilterManager() {
        $.ajax({
            type: "POST",
            url: "/api/project/filter",
            contentType: "application/x-www-form-urlencoded; charset=utr-8",
            data: {"filter": "기획"}
        }).done(res => {
            console.log("성공", res);
            $('.lists').empty();

            $('#all').removeClass();
            $('#backend').removeClass();
            $('#design').removeClass();
            $('#frontend').removeClass();
            $('#etc').removeClass();

            $('#manager').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error => {
            console.log("실패", error);
        })
    }

    // 기타 필터
    function projectFilterEtc() {
        $.ajax({
            type: "POST",
            url: "/api/project/filter",
            contentType: "application/x-www-form-urlencoded; charset=utr-8",
            data: {"filter": "기타"}
        }).done(res => {
            console.log("성공", res);
            $('.lists').empty();

            $('#all').removeClass();
            $('#backend').removeClass();
            $('#design').removeClass();
            $('#manager').removeClass();
            $('#frontend').removeClass();

            $('#etc').addClass('on');
            if (res.data.length === 0) {
                $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
            } else {
                // 새로운 프로젝트 리스트를 추가합니다.
                res.data.forEach(project => {
                    $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                });
            }
        }).fail(error => {
            console.log("실패", error);
        })
    }

    function searchProjects() {
        let keyword = document.querySelector(".recruit-ipt").value;
        $.ajax({
            url: "/api/project/search",
            type: "GET",
            data: {"keyword": keyword},
            success: function (response) {
                // 기존 프로젝트 리스트를 비웁니다.
                $('.lists').empty();
                // 검색 결과가 없을 때 메시지 표시
                if (response.data.length === 0) {
                    $('.lists').append('<p class="search-null">프로젝트가 존재하지 않습니다. 다시 검색해주세요.</p>');
                } else {
                    // 새로운 프로젝트 리스트를 추가합니다.
                    response.data.forEach(project => {
                        $('.lists').append(`
              <a href="/project/${project.id}" class="project-box">
                <span class="pj-type ${project.projectType == '사이드 프로젝트' ? 'pj' : 'study'}">${project.projectType}</span>
                <p class="title">
                  <strong class="state-ing">${project.status == 1 ? '모집 중' : '모집완료'}</strong>
                  <span>${project.projectName}</span>
                </p>
                <div class="cont-wrap">
                  <p class="content">${project.projectInfo}</p>
                </div>
                <ul class="pj-work">
                  ${project.roleNames.map(role => `<li>${role}</li>`).join('')}
                </ul>
                <ul class="count">
                  <li>${project.createTime}</li>
                  <li><i class="fa-regular fa-hand"></i> ${project.subscribe}명</li>
                  <li><i class="fa-solid fa-eye"></i> ${project.views}회</li>
                </ul>
              </a>
            `);
                    });
                }
            },
            error: function (error) {
                console.log("Error: ", error);
            }
        });
    }

    function clearSearch() {
        document.querySelector(".recruit-ipt").value = '';
        searchProjects(); // 검색어를 비운 상태로 searchProjects 호출
    }

    function handleKeyDown(event) {
        if (event.key === 'Enter') {
            searchProjects();
        }
    }

    document.querySelector(".recruit-ipt").addEventListener("keydown", handleKeyDown);

    // 페이지 로드 시 전체 프로젝트 로드
    window.onload = searchProjects;
</script>

</html>
